<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>List of field lines</title>
		
		<script src="editablegrid/editablegrid.js"></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_renderers.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_editors.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_validators.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_utils.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_charts.js" ></script>
		<link rel="stylesheet" href="editablegrid/editablegrid.css" type="text/css" media="screen">
		
		<script src="editablegrid/extensions/jquery/jquery-1.6.4.min.js" ></script>
		<script src="editablegrid/extensions/jquery/jquery-ui-1.8.16.custom.min.js" ></script>
		<link rel="stylesheet" href="editablegrid/extensions/jquery/jquery-ui-1.8.16.custom.css" type="text/css" media="screen">
		<script src="segment.js"></script>



        <link rel="stylesheet" type="text/css" href="simple.css" media="screen"/>
		
		<script>
			window.onload = function() {
				// this approach is interesting if you need to dynamically create data in Javascript
				var metaLine = [];
				metaLine.push({ name: "name",     label:"Name", datatype: "string", editable: true});
				metaLine.push({ name: "label",    label:"Label", datatype: "string", editable: true});
				metaLine.push({ name: "X0", 	  label:"X0", datatype: "double", editable: true});
				metaLine.push({ name: "Y0", 	  label:"Y0", datatype: "double", editable: true});
				metaLine.push({ name: "Z0", 	  label:"Z0", datatype: "double", editable: true});
				metaLine.push({ name: "type",     label:"Field", datatype: "string", editable: true});
				metaLine.push({ name: "color",    label:"Color", datatype: "string", editable: false});
				metaLine.push({ name: "nsegments",label:"Segments", datatype: "double", editable: true});
				metaLine.push({ name: "showlabel",label:"Show label", datatype: "string", editable: true});
				metaLine.push({ name: "interval", label:"Interval", datatype: "double", editable: true});
				metaLine.push({ name: "tolerance",label:"Tolerance", datatype: "double", editable: true});
				metaLine.push({ name: "action",   label:"D/D", datatype: "html", editable: false});

				metaLine[5].values = {"E":"Electric Field", "B":"Magnetic Field", "A":"Magnetic Potential"};
				metaLine[8].values = {"Y":"Yes", "N":"No"};

				LineGrid = new EditableGrid("3DSpaceLines");


				var metaSLine = [];
				metaSLine.push({ name: "name",     label:"Name", datatype: "string", editable: true});
				metaSLine.push({ name: "label",    label:"Label", datatype: "string", editable: true});
				metaSLine.push({ name: "X0", 	   label:"X0", datatype: "double", editable: true});
				metaSLine.push({ name: "Y0", 	   label:"Y0", datatype: "double", editable: true});
				metaSLine.push({ name: "Z0", 	   label:"Z0", datatype: "double", editable: true});
				metaSLine.push({ name: "X1", 	   label:"X1", datatype: "double", editable: true});
				metaSLine.push({ name: "Y1", 	   label:"Y1", datatype: "double", editable: true});
				metaSLine.push({ name: "Z1", 	   label:"Z1", datatype: "double", editable: true});
				metaSLine.push({ name: "NL", 	   label:"NL", datatype: "double", editable: true});				
				metaSLine.push({ name: "type",     label:"Field", datatype: "string", editable: true});
				metaSLine.push({ name: "color",    label:"Color", datatype: "string", editable: false});
				metaSLine.push({ name: "nsegments",label:"Segments", datatype: "double", editable: true});
				metaSLine.push({ name: "showlabel",label:"Show label", datatype: "string", editable: true});
				metaSLine.push({ name: "interval", label:"Interval", datatype: "double", editable: true});
				metaSLine.push({ name: "tolerance",label:"Tolerance", datatype: "double", editable: true});
				metaSLine.push({ name: "action",   label:"D/D", datatype: "html", editable: false});

				metaSLine[9].values = {"E":"Electric Field", "B":"Magnetic Field", "A":"Magnetic Potential"};
				metaSLine[12].values = {"Y":"Yes", "N":"No"};

				SLineGrid = new EditableGrid("3DSpaceSLines");


				var metaDLine = [];
				metaDLine.push({ name: "name",     label:"Name", datatype: "string", editable: true});
				metaDLine.push({ name: "label",    label:"Label", datatype: "string", editable: true});
				metaDLine.push({ name: "X0", 	   label:"X0", datatype: "double", editable: true});
				metaDLine.push({ name: "Y0", 	   label:"Y0", datatype: "double", editable: true});
				metaDLine.push({ name: "Z0", 	   label:"Z0", datatype: "double", editable: true});
				metaDLine.push({ name: "Nx", 	   label:"Nx", datatype: "double", editable: true});
				metaDLine.push({ name: "Ny", 	   label:"Ny", datatype: "double", editable: true});
				metaDLine.push({ name: "Nz", 	   label:"Nz", datatype: "double", editable: true});
				metaDLine.push({ name: "R", 	   label:"Radius", datatype: "double", editable: true});
				metaDLine.push({ name: "NL", 	   label:"NL", datatype: "double", editable: true});
				metaDLine.push({ name: "NA", 	   label:"NA", datatype: "double", editable: true});					
				metaDLine.push({ name: "type",     label:"Field", datatype: "string", editable: true});
				metaDLine.push({ name: "color",    label:"Color", datatype: "string", editable: false});
				metaDLine.push({ name: "nsegments",label:"Segments", datatype: "double", editable: true});
				metaDLine.push({ name: "showlabel",label:"Show label", datatype: "string", editable: true});
				metaDLine.push({ name: "interval", label:"Interval", datatype: "double", editable: true});
				metaDLine.push({ name: "tolerance",label:"Tolerance", datatype: "double", editable: true});
				metaDLine.push({ name: "action",   label:"D/D", datatype: "html", editable: false});

				metaDLine[11].values = {"E":"Electric Field", "B":"Magnetic Field", "A":"Magnetic Potential"};
				metaDLine[14].values = {"Y":"Yes", "N":"No"};

				DLineGrid = new EditableGrid("3DSpaceDLines");


				var metaBLine = [];
				metaBLine.push({ name: "name",     label:"Name", datatype: "string", editable: true});
				metaBLine.push({ name: "label",    label:"Label", datatype: "string", editable: true});
				metaBLine.push({ name: "X0", 	   label:"X0", datatype: "double", editable: true});
				metaBLine.push({ name: "Y0", 	   label:"Y0", datatype: "double", editable: true});
				metaBLine.push({ name: "Z0", 	   label:"Z0", datatype: "double", editable: true});
				metaBLine.push({ name: "R", 	   label:"Radius", datatype: "double", editable: true});
				metaBLine.push({ name: "NL", 	   label:"NL", datatype: "double", editable: true});				
				metaBLine.push({ name: "type",     label:"Field", datatype: "string", editable: true});
				metaBLine.push({ name: "color",    label:"Color", datatype: "string", editable: false});
				metaBLine.push({ name: "nsegments",label:"Segments", datatype: "double", editable: true});
				metaBLine.push({ name: "showlabel",label:"Show label", datatype: "string", editable: true});
				metaBLine.push({ name: "interval", label:"Interval", datatype: "double", editable: true});
				metaBLine.push({ name: "tolerance",label:"Tolerance", datatype: "double", editable: true});
				metaBLine.push({ name: "action",   label:"D/D", datatype: "html", editable: false});

				metaBLine[7].values = {"E":"Electric Field", "B":"Magnetic Field", "A":"Magnetic Potential"};
				metaBLine[10].values = {"Y":"Yes", "N":"No"};

				BLineGrid = new EditableGrid("3DSpaceBLines");

				
				var newLineArray = [];
				for(var i=0; i<parent.opener.listLines.length; i++){
					var tmp = parent.opener.listLines[i].returnValues();
					if((tmp.name != 'SLine')&&(tmp.name != 'DLine')&&(tmp.name != 'BLine'))
						newLineArray.push({name: 'values', values: JSON.parse(JSON.stringify(tmp))});
				}
				LineGrid.load({"metadata": metaLine, "data": newLineArray});


				var newSLineArray = [];
				for(var i=0; i<parent.opener.listSLines.length; i++){
					var tmp = parent.opener.listSLines[i];
					newSLineArray.push({name: 'values', values: JSON.parse(JSON.stringify(tmp))});
				}
				SLineGrid.load({"metadata": metaSLine, "data": newSLineArray});


				var newDLineArray = [];
				for(var i=0; i<parent.opener.listDLines.length; i++){
					var tmp = parent.opener.listDLines[i];
					newDLineArray.push({name: 'values', values: JSON.parse(JSON.stringify(tmp))});
				}
				DLineGrid.load({"metadata": metaDLine, "data": newDLineArray});


				var newBLineArray = [];
				for(var i=0; i<parent.opener.listBLines.length; i++){
					var tmp = parent.opener.listBLines[i];
					newBLineArray.push({name: 'values', values: JSON.parse(JSON.stringify(tmp))});
				}
				BLineGrid.load({"metadata": metaBLine, "data": newBLineArray});


		       	var clrLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML =  "<input type='color' id='colorLine"+cell.rowIndex+"' onchange='clickLineColor("+cell.rowIndex+")' value='"+value.toLowerCase()+"' style='width:85%;''>";
		     		
		     	} });
		     	var clrSLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML =  "<input type='color' id='colorSLine"+cell.rowIndex+"' onchange='clickSLineColor("+cell.rowIndex+")' value='"+value.toLowerCase()+"' style='width:85%;''>";
		     		
		     	} });
		     	var clrDLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML =  "<input type='color' id='colorDLine"+cell.rowIndex+"' onchange='clickDLineColor("+cell.rowIndex+")' value='"+value.toLowerCase()+"' style='width:85%;''>";
		     		
		     	} });
		     	var clrBLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML =  "<input type='color' id='colorBLine"+cell.rowIndex+"' onchange='clickBLineColor("+cell.rowIndex+")' value='"+value.toLowerCase()+"' style='width:85%;''>";
		     		
		     	} });

                var afLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "<a onclick=\"if (confirm('Are you sure you want to delete this line? ')) LineGrid.remove(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
			    					 "<img src=\"delete.png\" border=\"0\" alt=\"delete\" title=\"delete\"/></a>";
		         	cell.innerHTML+= "&nbsp;<a onclick=\"LineGrid.duplicate(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
		                         	 "<img src=\"duplicate.png\" border=\"0\" alt=\"duplicate\" title=\"duplicate\"/></a>";
		       	}});
		       	var afSLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "<a onclick=\"if (confirm('Are you sure you want to delete this segment? ')) SLineGrid.remove(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
			    					 "<img src=\"delete.png\" border=\"0\" alt=\"delete\" title=\"delete\"/></a>";
		         	cell.innerHTML+= "&nbsp;<a onclick=\"SLineGrid.duplicate(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
		                         	 "<img src=\"duplicate.png\" border=\"0\" alt=\"duplicate\" title=\"duplicate\"/></a>";
		       	}});
		       	var afDLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "<a onclick=\"if (confirm('Are you sure you want to delete this disk? ')) DLineGrid.remove(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
			    					 "<img src=\"delete.png\" border=\"0\" alt=\"delete\" title=\"delete\"/></a>";
		         	cell.innerHTML+= "&nbsp;<a onclick=\"DLineGrid.duplicate(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
		                         	 "<img src=\"duplicate.png\" border=\"0\" alt=\"duplicate\" title=\"duplicate\"/></a>";
		       	}});
		       	var afBLine = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "<a onclick=\"if (confirm('Are you sure you want to delete this sphere? ')) BLineGrid.remove(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
			    					 "<img src=\"delete.png\" border=\"0\" alt=\"delete\" title=\"delete\"/></a>";
		         	cell.innerHTML+= "&nbsp;<a onclick=\"BLineGrid.duplicate(" + cell.rowIndex + ");\" style=\"cursor:pointer\">" +
		                         	 "<img src=\"duplicate.png\" border=\"0\" alt=\"duplicate\" title=\"duplicate\"/></a>";
		       	}});

                LineGrid.setCellRenderer("action", afLine);
                LineGrid.setCellRenderer("color", clrLine);
				LineGrid.renderGrid("tableLines", "testgrid");

                SLineGrid.setCellRenderer("action", afSLine);
                SLineGrid.setCellRenderer("color", clrSLine);
				SLineGrid.renderGrid("tableSLines", "testgrid");

                DLineGrid.setCellRenderer("action", afDLine);
                DLineGrid.setCellRenderer("color", clrDLine);
				DLineGrid.renderGrid("tableDLines", "testgrid");

                BLineGrid.setCellRenderer("action", afBLine);
                BLineGrid.setCellRenderer("color", clrBLine);
				BLineGrid.renderGrid("tableBLines", "testgrid");
			}

            EditableGrid.prototype.duplicate = function(rowIndex)
            {
            	// copy values from given row
            	var values = this.getRowValues(rowIndex);
            	values['name'] = values['name'] + ' (copy)';

            	var newRowId = 0;
            	for (var r = 0; r < this.getRowCount(); r++) 
            		newRowId = Math.max(newRowId, parseInt(this.getRowId(r)) + 1);
            	this.insertAfter(rowIndex, newRowId, values);
            };

            function applyChanges(){
            	for(var i=this.parent.opener.listLines.length-1; i>=0; i--){
            		this.parent.opener.cleanupLine(i);
            		this.parent.opener.listLines.splice(i,1);
            	}

            	for (var r = 0; r < this.LineGrid.getRowCount(); r++) {
            		var values = this.LineGrid.getRowValues(r);
            		//values.tolerance = 1e-11;
					this.parent.opener.addNewLine(values, true);
            	}
            	
            	for(var i=this.parent.opener.listSLines.length-1; i>=0; i--)
            		this.parent.opener.listSLines.splice(i,1);
				for (var r = 0; r < this.SLineGrid.getRowCount(); r++) {
            		var values = this.SLineGrid.getRowValues(r);
            		//values.tolerance = 1e-11;
            		this.parent.opener.addNewSLines(values, true);
            		this.parent.opener.listSLines.push(values);					
            	}
            	
            	for(var i=this.parent.opener.listDLines.length-1; i>=0; i--)
            		this.parent.opener.listDLines.splice(i,1);
            	for (var r = 0; r < this.DLineGrid.getRowCount(); r++) {
            		var values = this.DLineGrid.getRowValues(r);
            		//values.tolerance = 1e-11;
					this.parent.opener.addNewDLines(values, true);
            		this.parent.opener.listDLines.push(values);						
            	}

            	for(var i=this.parent.opener.listBLines.length-1; i>=0; i--)
            		this.parent.opener.listBLines.splice(i,1);
            	for (var r = 0; r < this.BLineGrid.getRowCount(); r++) {
            		var values = this.BLineGrid.getRowValues(r);
            		//values.tolerance = 1e-11;
					this.parent.opener.addNewBLines(values, true);
            		this.parent.opener.listBLines.push(values);						
            	}

            	this.parent.opener.restartLines();
            	window.close();
 				return true;
			}

			function addNewLine(){
				var values={};
				values.name="test_"+Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 8);
				values.label=values.name;

				values.color = '#AAAAAA';	values.type  = 'B';
				values.X0 = 50; values.Y0 = 0; values.Z0 = 0;
				values.tolerance = 1e-11; values.interval = 50; values.nsegments = 4; values.showlabel = "Y";

				var newRowId = 0;
            	for (var r = 0; r < this.LineGrid.getRowCount(); r++) 
            		newRowId = Math.max(newRowId, parseInt(this.LineGrid.getRowId(r)) + 1);

				this.LineGrid.insertAfter(this.LineGrid.getRowCount(), newRowId, values);
 				return true;
			}

			function addNewSLine(){
				var values={};
				values.name="test_"+Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 8);
				values.label=values.name;

				values.color = '#AAAAAA';	values.type  = 'B';
				values.X0 = 0; values.Y0 = 0; values.Z0 = -50;	values.X1 = 0; values.Y1 = 0; values.Z1 = -50; values.NL = 10;
				values.tolerance = 1e-11; values.interval = 50; values.nsegments = 5; values.showlabel = "Y";

				var newRowId = 0;
            	for (var r = 0; r < this.SLineGrid.getRowCount(); r++) 
            		newRowId = Math.max(newRowId, parseInt(this.SLineGrid.getRowId(r)) + 1);

				this.SLineGrid.insertAfter(this.SLineGrid.getRowCount(), newRowId, values);
 				return true;
			}

			function addNewDLine(){
				var values={};
				values.name="test_"+Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 8);
				values.label=values.name;

				values.color = '#AAAAAA';	values.type  = 'B';
				values.X0 = 0; values.Y0 = 0; values.Z0 = -50;	values.Nx = 0; values.Ny = 0; values.Nz = 1; 
				values.R = 15; values.NL = 3;
				values.tolerance = 1e-11; values.interval = 50; values.nsegments = 5; values.showlabel = "Y";

				var newRowId = 0;
            	for (var r = 0; r < this.DLineGrid.getRowCount(); r++) 
            		newRowId = Math.max(newRowId, parseInt(this.DLineGrid.getRowId(r)) + 1);

				this.DLineGrid.insertAfter(this.DLineGrid.getRowCount(), newRowId, values);
 				return true;
			}

			function addNewBLine(){
				var values={};
				values.name="test_"+Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 8);
				values.label=values.name;

				values.color = '#AA00AA';	values.type  = 'E';
				values.X0 = 0; values.Y0 = 30; values.Z0 = 0;	values.R = 15; values.NL = 3;
				values.tolerance = 1e-11; values.interval = 50; values.nsegments = 5; values.showlabel = "Y";

				var newRowId = 0;
            	for (var r = 0; r < this.BLineGrid.getRowCount(); r++) 
            		newRowId = Math.max(newRowId, parseInt(this.BLineGrid.getRowId(r)) + 1);

				this.BLineGrid.insertAfter(this.BLineGrid.getRowCount(), newRowId, values);
 				return true;
			}

			function clickLineColor(rowIndex){
				var c = document.getElementById("colorLine"+rowIndex).value;
				window.LineGrid.setValueAt(rowIndex, 6, c);
			}
			function clickSLineColor(rowIndex){
				var c = document.getElementById("colorSLine"+rowIndex).value;
				window.SLineGrid.setValueAt(rowIndex, 10, c);
			}
			function clickDLineColor(rowIndex){
				var c = document.getElementById("colorDLine"+rowIndex).value;
				window.DLineGrid.setValueAt(rowIndex, 12, c);
			}
			function clickBLineColor(rowIndex){
				var c = document.getElementById("colorBLine"+rowIndex).value;
				window.BLineGrid.setValueAt(rowIndex, 8, c);
			}
		</script>		
	</head>
	
	<body>
		<div id="tableLines"></div>
		<button onclick="return addNewLine();">Add Line</button>
		<hr/>
		<div id="tableSLines"></div>
		<button onclick="return addNewSLine();">Add Lines along Segment</button>
		<hr/>
		<div id="tableDLines"></div>
		<button onclick="return addNewDLine();">Add Lines on Disk</button>
		<hr/>
		<div id="tableBLines"></div>
		<button onclick="return addNewBLine();">Add Lines on Sphere</button>
		<hr/>
		<input type="submit" value="Submit" onclick="return applyChanges();"/>
		<button type="cancel" onclick="window.close();">Cancel</button>
    </body>

</html>
