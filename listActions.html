<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>EditableGrid - Minimal demo - Creating grid in Javascript</title>
		
		<script src="editablegrid/editablegrid.js"></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_renderers.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_editors.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_validators.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_utils.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="editablegrid/editablegrid_charts.js" ></script>
		<link rel="stylesheet" href="editablegrid/editablegrid.css" type="text/css" media="screen">
		
		<script src="scripts/w3color.js"></script>
		<script src="editablegrid/extensions/jquery/jquery-1.6.4.min.js" ></script>
		<script src="editablegrid/extensions/jquery/jquery-ui-1.8.16.custom.min.js" ></script>
		<link rel="stylesheet" href="editablegrid/extensions/jquery/jquery-ui-1.8.16.custom.css" type="text/css" media="screen">
		<script src="interaction.js"></script>
		<script src="scripts/convert.js"></script>

        <link rel="stylesheet" type="text/css" href="simple.css" media="screen"/>
		
		<script>

			var ActionGrid;
			var tmp = 5;
			var wi_values;

			window.onload = function() {

				// this approach is interesting if you need to dynamically create data in Javascript
                var metaAction = [];
				metaAction.push({ name: "label", label: "Label", datatype: "string", editable: false});
				metaAction.push({ name: "picture", label: "Icon", datatype: "string", editable: false});
				metaAction.push({ name: "Q", label: "Q", datatype: "double", editable: false});
				metaAction.push({ name: "M0", label: "M0", datatype: "double", editable: false});
				metaAction.push({ name: "rx0", label:"X0", datatype: "string", editable: false});
				metaAction.push({ name: "ry0", label:"Y0", datatype: "string", editable: false});
				metaAction.push({ name: "rz0", label:"Z0", datatype: "string", editable: false});

				metaAction.push({ name: "G", label:"Gravity", datatype: "boolean", editable: true});
				metaAction.push({ name: "E", label:"Electric", datatype: "boolean", editable: true});
				metaAction.push({ name: "H", label:"Hook", datatype: "boolean", editable: true});
				metaAction.push({ name: "K", label:"K", datatype: "double", editable: true});
				metaAction.push({ name: "R", label:"R", datatype: "double", editable: true});
				metaAction.push({ name: "A", label:"alpha", datatype: "double", editable: true});
				metaAction.push({ name: "D", label: "User", datatype: "boolean", editable: true});
				metaAction.push({ name: "Fx", label: "F(r)", datatype: "string", editable: true});
				metaAction.push({ name: "trace", label: "Trace", datatype: "boolean", editable: true});
				metaAction.push({ name: "name", label: "Name", datatype: "string", editable: false});

				ActionGrid = new EditableGrid("DemoGridJsData");
				ActionGrid.load({"metadata": metaAction, "data": []});

				var bb = new CellRenderer({render: function(cell, value) { 
					if(value != 'none') 
		       			cell.innerHTML = "<img style='display: block; margin: auto' src=\"icons/" + value + ".gif\">";
		       		else{
		       			cell.innerHTML = "<canvas style='display: block; margin: auto' id='canvas_"+cell.rowIndex+"' width=16 height=16></canvas>";
		       			var canvas=document.getElementById("canvas_"+cell.rowIndex);
		       			var ctx=canvas.getContext("2d");
						ctx.beginPath();
  						ctx.arc(7.5,7.5,7.5,0,Math.PI*2);
  						ctx.closePath();
  						var name = window.ActionGrid.getValueAt(cell.rowIndex,0);
  						for(var i=0; i<parent.opener.parent.opener.ListParticles.length; i++)
  							if(parent.opener.parent.opener.ListParticles[i].name == name)
  								ctx.fillStyle=parent.opener.parent.opener.ListParticles[i].color;
  						ctx.fill();
 						ctx.stroke();
		       		}
		       	} });
		        ActionGrid.setCellRenderer("picture", bb); 

								
				ActionGrid.setHeaderRenderer("G", new InfoHeaderRenderer("Gravity"));
				ActionGrid.setHeaderRenderer("E", new InfoHeaderRenderer("Electric"));

				var aK = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "K <input onchange=\"if (confirm('Are you sure you want to apply this to all particles? ')) setAllKHookValues(this.value);\" type=\"text\" size=\"4\"/>";
		       	}});
		       	ActionGrid.setHeaderRenderer("K", aK);

				var aR = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "R <input onchange=\"if (confirm('Are you sure you want to apply this to all particles? ')) setAllRHookValues(this.value);\" type=\"text\" size=\"4\"/>";
		       	}});
				ActionGrid.setHeaderRenderer("R", aR);

				var aA = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "A <input onchange=\"if (confirm('Are you sure you want to apply this to all particles? ')) setAllAHookValues(this.value);\" type=\"text\" size=\"4\"/>";
		       	}});
				ActionGrid.setHeaderRenderer("A", aA);
				var aFx = new CellRenderer({render: function(cell, value) {
		     		cell.innerHTML = "F(r) <input onchange=\"if (confirm('Are you sure you want to apply this to all particles? ')) setAllFxValues(this.value);\" type=\"text\" size=\"10\"/>";
		       	}});
				ActionGrid.setHeaderRenderer("Fx", aFx);

				ActionGrid.renderGrid("tableActions", "testgrid");



				wi_values = parent.opener.wi_values;
				var PL = parent.opener.parent.opener.ListParticles;
				var IL = parent.opener.parent.opener.ListInteractions;
				var values;

				for (var r = 0, rr = 0; r < PL.length; r++)
					if(PL[r].name != wi_values.name){

						values = {
							"label": PL[r].label,
							"name": PL[r].name,
							"picture": PL[r].picture,
							"Q": PL[r].Q, 
							"M0": PL[r].M0,
							"rx0": PL[r].rx0, "ry0": PL[r].ry0, "rz0": PL[r].rz0,
							"G": false, "E": false, 
							"H": false, "K": "0", "R": "0", "A": "0",
							"D": false, "Fx": "0", 
							"trace": false};

						var ii = getInteraction(wi_values.name, PL[r].name, IL);
						if(ii>=0){
							values['G']=IL[ii].G;
							values['E']=IL[ii].E;
							values['H']=IL[ii].H;
							values['A']=IL[ii].A;
							values['R']=IL[ii].R;
							values['K']=IL[ii].K;
							values['D']=IL[ii].D;
							values['Fx']=IL[ii].Fx;
							values['trace']=IL[ii].trace;
						}
						ActionGrid.addRow(rr++, values);
					}


				var x = document.getElementById("PName");
				x.innerHTML = wi_values.label;

				var x = document.getElementById("PPicture");
				if(wi_values.picture != 'none')
					x.innerHTML = "<img src=\"icons/" + wi_values['picture'].toLowerCase() + ".gif\">";
				else{
					x.innerHTML = "<canvas style='display: block; margin: auto' id='canvas_Main' width=16 height=16></canvas>";
		       			var canvas=document.getElementById("canvas_Main");
		       			var ctx=canvas.getContext("2d");
						ctx.beginPath();
  						ctx.arc(7.5,7.5,7.5,0,Math.PI*2);
  						ctx.closePath();
  						for(var i=0; i<parent.opener.parent.opener.ListParticles.length; i++)
  							if(parent.opener.parent.opener.ListParticles[i].name == wi_values.name)
  								ctx.fillStyle=parent.opener.parent.opener.ListParticles[i].color;
  						ctx.fill();
 						ctx.stroke();
				}
					
				//for(var i=1;i<7;i++)
            		//ActionGrid.table.childNodes[1].firstChild.cells[i].bgColor="#aa0";
				/*window.ActionGrid.tHead.childNodes[0].cells[0].width=10;
				window.ActionGrid.tHead.childNodes[0].cells[1].width=1;
				window.ActionGrid.tHead.childNodes[0].cells[2].width=1;
				window.ActionGrid.tHead.childNodes[0].cells[9].width=50;
				window.ActionGrid.tHead.childNodes[0].cells[10].width=10;
				window.ActionGrid.tHead.childNodes[0].cells[11].width=50;
				window.ActionGrid.tHead.childNodes[0].cells[12].width=50;
				window.ActionGrid.tHead.childNodes[0].cells[13].width=1;
				window.ActionGrid.tHead.childNodes[0].cells[14].width=5;	
				window.ActionGrid.tHead.childNodes[0].cells[15].width=5;*/
			}

            function getInteraction(nEE, nER, interactions){
            	for (var i = interactions.length - 1; i >= 0; i--) 
            		if ((interactions[i].nEE == nEE) && (interactions[i].nER == nER)){
            			return i;
            		}
            	return -1;
            }

            function removeInteraction(nEE){
           		for (var i = parent.opener.parent.opener.ListInteractions.length - 1; i >= 0; i--) 
            		if (parent.opener.parent.opener.ListInteractions[i].nEE == nEE)
            			parent.opener.parent.opener.ListInteractions.splice(i,1);
            }


			// this will be used to render our table headers
			function InfoHeaderRenderer(message) { 
				this.message = message; 
			};

            InfoHeaderRenderer.prototype = new CellRenderer();
			InfoHeaderRenderer.prototype.render = function(cell, value){
				if (value) {
					// here we don't use cell.innerHTML = "..." in order not to break the sorting header that has been created for us (cf. option enableSort: true)
					var link = document.createElement("a");
					link.href = "javascript:{if (confirm('Are you ready to apply "+this.message+" interactions to all particles ? ')) {setAllValues('"+this.message+"')}};";
					$(link).html("<p>ALL</p>");
					cell.appendChild(document.createTextNode("\u00a0\u00a0"));
					cell.appendChild(link);
				}
			};


			function setAllValues(str){
				for (var r = 0; r < this.ActionGrid.getRowCount(); r++)
					switch(str){
						case 'Gravity' : this.ActionGrid.setValueAt(r,7,true); break;
						case 'Electric' : this.ActionGrid.setValueAt(r,8,true); break;
						case 'Hook' : this.ActionGrid.setValueAt(r,9,true); break;
					}
			}

			function setAllKHookValues(str){
				for (var r = 0; r < this.ActionGrid.getRowCount(); r++){
					this.ActionGrid.setValueAt(r,9,true);
					this.ActionGrid.setValueAt(r,10,str);
				}
			}
			function setAllRHookValues(str){
				for (var r = 0; r < this.ActionGrid.getRowCount(); r++){
					this.ActionGrid.setValueAt(r,9,true);
					this.ActionGrid.setValueAt(r,11,str);
				}
			}
			function setAllAHookValues(str){
				for (var r = 0; r < this.ActionGrid.getRowCount(); r++){
					this.ActionGrid.setValueAt(r,9,true);
					this.ActionGrid.setValueAt(r,12,str);
				}
			}

			function setAllFxValues(str){
				for (var r = 0; r < this.ActionGrid.getRowCount(); r++){
					this.ActionGrid.setValueAt(r,13,true);
					this.ActionGrid.setValueAt(r,14,str);
				}
			}

            function applyChanges(){
            	removeInteraction(wi_values.name);
            	for (var r = 0; r < this.ActionGrid.getRowCount(); r++) {
            		var v = this.ActionGrid.getRowValues(r);
            		//if(v['G']||v['E']||v['H']||v['D']){
            			var values = {
							"nEE": wi_values.name,
							"nER": v.name,
							"G": v.G, "E": v.E, 
							"H": v.H, "K": v.K, "R": v.R, "A": v.A,
							"D": v.D, "Fx": v.Fx, "trace": v.trace};
							parent.opener.parent.opener.ListInteractions.push(new Interaction(values));
            		//}
            	}
            	window.close();
 				return true;
			}
		</script>
		
	</head>
	
	<body>

        <div id="FocusParticle">
        <table><tr><td>Defining interactions for particle </td><td><b><p id='PName'></p></b></td><td><p id='PPicture'></p></td></tr></table></div>
		<div id="tableActions"></div>
		<input type="submit" value="Submit" onclick="return applyChanges();"/>
		<button type="cancel" onclick="window.close();">Cancel</button>
	</body>

</html>
